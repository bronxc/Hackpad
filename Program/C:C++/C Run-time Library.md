#C Run-time Library  

--------------------------------  

###0x00 前言  
运行时库（runtime library，又称运行期库），在计算机程序设计领域中，是指一种被编译器用来实现编程语言内置函数以提供该语言程序运行时（执行）支持的一种特殊的计算机程序库。这种库一般包括基本的输入输出或是内存管理等支持。它是一群支持正在运行程序的函数，与操作系统合作提供诸如数学运算、输入输出等功能，让程序的作者不需要“重新发明轮子”，并善用操作系统提供的功能。  

运行时库由编译器决定，以面向编程语言，提供其最基本的执行时需要。比如Visual Basic需要复杂的运行时库支持而C的运行时库则相对简单。当然这还是由编译器厂商决定的。运行时库中的函数可能对程序员透明，也可能不透明。这也是由编译器厂商忖度语言执行环境的需求而决定的。
早期的运行期库（例如Fortran）提供了数学运算的能力。其他语言增加了诸如垃圾回收的先进功能，通常用于支持对象数据结构。
许多近代语言设计了更大的运行环境并添加更多功能。很多面向对象语言也包含了分派器与类别读取器。Java虚拟机（JVM）便是此类的典型运行环境：它也在运行期直译或编译具可携性的二进制Java程序。而.NET架构也是另外一个运行期库的实例。  

异常处理（Exception handling）是专门处理运行期错误的语言机制，使程序员可以完全捕捉非预期错误，或没有适当处理的错误结果。
动态链接库或静态链接库与运行时库的分类角度不同，不得相提并论。  

下面我们对 C 运行时库进行详细的了解。


###0x01 正文  

C 运行时库 (CRT)  
C 运行时库 (CRT) 是集成了 ISO C99 标准库的 C++ 标准库。 实现 CRT 的 Visual C++ 库支持用于 .NET 开发的本机代码开发、本机和托管混合代码以及纯托管代码。 所有版本的 CRT 都支持多线程开发。 大多数的库都支持通过静态链接将库直接链接到代码中，或通过动态链接让代码使用常用 DLL 文件。

__运行时库选项__  

|选项|	说明|
|----|----|
|/MD|	定义 \_MT 和 \_DLL 以便同时从标准 .h 文件中选择运行时例程的多线程特定版本和 DLL 特定版本。此选项还使编译器将库名 MSVCRT.lib 放入 .obj 文件中。</br>用此选项编译的应用程序静态链接到 MSVCRT.lib。该库提供允许链接器解析外部引用的代码层。实际工作代码包含在 MSVCR71.DLL 中，该库必须在运行时对于与 MSVCRT.lib 链接的应用程序可用。</br>当在定义了 \_STATIC\_CPPLIB (/D\_STATIC\_CPPLIB) 的情况下使用 /MD 时，它将导致应用程序通过静态多线程标准 C++ 库 (libcpmt.lib) 而非动态版本 (msvcprt.lib) 进行链接，同时仍通过 msvcrt.lib 动态链接到主 CRT。|
|/MDd|	定义 \_DEBUG、\_MT 和 \_DLL，以便从标准 .h 文件中选择运行时例程的调试多线程特定版本和 DLL 特定版本。它还使编译器将库名 MSVCRTD.lib 放入 .obj 文件中。|
|/ML|	使编译器将库名 LIBC.lib 放入 .obj 文件中，以便链接器使用 LIBC.lib 解析外部符号。这是编译器的默认操作。LIBC.lib 不提供多线程支持。|
|/MLd|	定义 \_DEBUG 并使编译器将库名 LIBCD.lib 放入 .obj 文件中，以便链接器使用 LIBCD.lib 解析外部符号。LIBCD.lib 不提供多线程支持。|
|/MT|	定义 \_MT，以便从标准头 (.h) 文件中选择运行时例程的多线程特定版本。此选项还使编译器将库名 LIBCMT.lib 放入 .obj 文件中，以便链接器使用 LIBCMT.lib 解析外部符号。创建多线程程序需要 /MT 或 /MD（或它们的调试等效选项 /MTd 或 /MDd）。|
|/MTd	|定义 \_DEBUG 和 \_MT。定义 \_MT 会导致从标准 .h 文件中选择运行时例程的多线程特定版本。此选项还使编译器将库名 LIBCMTD.lib 放入 .obj 文件中，以便链接器使用 LIBCMTD.lib 解析外部符号。创建多线程程序需要 /MTd 或 /MDd（或它们的非调试等效选项 /MT 或 MD）。|
|/LD	|创建 DLL。</br>将 /DLL 选项传递到链接器。链接器查找 DllMain 函数，但并不需要该函数。如果没有编写 DllMain 函数，链接器将插入返回 TRUE 的 DllMain 函数。</br>链接 DLL 启动代码。</br>如果命令行上未指定导出 (.exp) 文件，则创建导入库 (.lib)；将导入库链接到调用您的 DLL 的应用程序。</br>将 /Fe 解释为命名 DLL 而不是 .exe 文件；默认程序名成为基名称.dll 而不是基名称.exe。</br>如果还未显式指定 /M 选项之一，则将默认运行时库支持更改为 /MT。|
|/LDd	|创建调试 DLL。定义 _DEBUG。|

>警告   不要混合使用运行时库的静态版本和动态版本。在一个进程中有多个运行时库副本会导致问题，因为副本中的静态数据不与其他副本共享。链接器禁止在 .exe 文件内部既使用静态版本又使用动态版本链接，但您仍可以使用运行时库的两个（或更多）副本。例如，当与用动态 (DLL) 版本的运行时库链接的 .exe 文件一起使用时，用静态（非 DLL）版本的运行时库链接的动态链接库可能导致问题。（还应该避免在一个进程中混合使用这些库的调试版本和非调试版本）。



</br> 

---------------------------------  
References:  
维基百科:  <https://zh.wikipedia.org/wiki/运行时库>  
MSDN:  <https://msdn.microsoft.com/zh-cn/library/cc438633(v=vs.71).aspx>


</br>  
Author: xx  
Time: 2016.11.29